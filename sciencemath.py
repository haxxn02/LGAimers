import os
import json
import time
from openai import OpenAI
from tqdm import tqdm
from dotenv import load_dotenv # [추가된 부분]

# 1. .env 파일 로드
load_dotenv()

# 2. 환경변수에서 토큰 가져오기
FRIENDLI_TOKEN = os.getenv("FRIENDLI_TOKEN")

# [안전장치] 토큰이 잘 불러와졌는지 확인
if not FRIENDLI_TOKEN:
    print("❌ 오류: .env 파일을 찾을 수 없거나 토큰이 없습니다.")
    print("test.py와 같은 폴더에 .env 파일이 있는지 확인해주세요.")
    exit()

client = OpenAI(
    api_key=FRIENDLI_TOKEN,
    base_url="https://api.friendli.ai/serverless/v1"
)

# 모델 ID
TEACHER_MODEL_ID = "LGAI-EXAONE/K-EXAONE-236B-A23B"

# 질문 리스트 (최소 500개 목표!)
seed_prompts = [
    "뉴턴의 운동 법칙이 일상적인 물체 운동을 어떻게 설명하는지 설명해줘.",
    "관성계와 비관성계의 차이를 물리적 관점에서 설명해줘.",
    "에너지 보존 법칙이 성립하기 위한 조건을 설명해줘.",
    "열역학 제2법칙이 시간의 방향성과 연결되는 이유를 설명해줘.",
    "엔트로피 증가가 자발적 과정의 기준이 되는 이유를 설명해줘.",
    "파동과 입자 이중성이 고전 물리학으로 설명되지 않는 이유를 설명해줘.",
    "불확정성 원리가 측정 기술의 한계가 아닌 이유를 설명해줘.",
    "전기장과 자기장이 상호 작용하는 방식을 설명해줘.",
    "전자기파가 매질 없이 전파될 수 있는 이유를 설명해줘.",
    "반도체에서 도핑이 전기적 성질을 변화시키는 원리를 설명해줘.",

    "원자 구조에서 전자 껍질 개념이 필요한 이유를 설명해줘.",
    "주기율표가 원소의 화학적 성질을 예측할 수 있는 이유를 설명해줘.",
    "공유 결합과 이온 결합의 형성 원리를 비교해줘.",
    "결합 에너지가 화학 반응의 안정성과 연결되는 이유를 설명해줘.",
    "반응 속도가 온도에 따라 달라지는 이유를 설명해줘.",
    "촉매가 활성화 에너지를 낮추는 원리를 설명해줘.",
    "화학 평형 상태에서도 반응이 멈추지 않는 이유를 설명해줘.",
    "산·염기 개념이 정의 방식에 따라 달라지는 이유를 설명해줘.",
    "산화·환원 반응이 전자 이동으로 설명되는 이유를 설명해줘.",
    "전기 화학 반응이 전압을 발생시키는 원리를 설명해줘.",

    "세포가 생명체의 기본 단위로 간주되는 이유를 설명해줘.",
    "세포막이 선택적 투과성을 가지는 원리를 설명해줘.",
    "효소가 반응 특이성을 가지는 이유를 설명해줘.",
    "세포 호흡에서 ATP가 에너지 화폐로 사용되는 이유를 설명해줘.",
    "광합성에서 빛 에너지가 화학 에너지로 전환되는 과정을 설명해줘.",
    "유전 정보가 DNA 구조에 안정적으로 저장되는 이유를 설명해줘.",
    "전사와 번역 과정이 분리되어 있는 이유를 설명해줘.",
    "돌연변이가 항상 해로운 결과를 낳지 않는 이유를 설명해줘.",
    "자연 선택이 진화의 핵심 메커니즘이 되는 이유를 설명해줘.",
    "항상성이 생명 유지에 필수적인 이유를 설명해줘.",

    "피드백 제어가 공학 시스템에서 안정성을 높이는 이유를 설명해줘.",
    "센서와 액추에이터가 시스템 제어에서 각각 어떤 역할을 하는지 설명해줘.",
    "신호를 아날로그와 디지털로 구분하는 이유를 설명해줘.",
    "샘플링 이론이 신호 복원에 중요한 이유를 설명해줘.",
    "구조 설계에서 안전 계수를 사용하는 이유를 설명해줘.",
    "재료의 탄성 한계가 설계 기준으로 중요한 이유를 설명해줘.",
    "열 전달에서 전도·대류·복사의 차이를 설명해줘.",
    "에너지 효율이 공학 설계에서 핵심 지표가 되는 이유를 설명해줘.",
    "자동화 시스템에서 오류 검출이 중요한 이유를 설명해줘.",
    "공학 문제 해결에서 모델링이 필요한 이유를 설명해줘.",
#50
    "힘의 합력이 0일 때 물체의 운동 상태를 설명해줘.",
    "가속도가 속도 변화율로 정의되는 이유를 설명해줘.",
    "일과 에너지가 동일한 단위를 사용하는 이유를 설명해줘.",
    "마찰력이 항상 운동을 방해하지는 않는 이유를 설명해줘.",
    "열평형 상태가 성립하기 위한 조건을 설명해줘.",
    "열기관의 효율에 이론적 한계가 존재하는 이유를 설명해줘.",
    "파동의 간섭이 발생하는 조건을 설명해줘.",
    "빛의 굴절이 매질의 성질과 연결되는 이유를 설명해줘.",
    "전압이 전하 이동의 원인이 되는 이유를 설명해줘.",
    "자기장이 움직이는 전하에만 힘을 작용하는 이유를 설명해줘.",
    "화학 결합 형성이 에너지 감소와 연결되는 이유를 설명해줘.",
    "전자 배치가 원자의 화학적 성질을 결정하는 이유를 설명해줘.",
    "반응 차수가 반응 메커니즘과 직접 일치하지 않는 이유를 설명해줘.",
    "평형 상수가 온도에 따라 변하는 이유를 설명해줘.",
    "완충 용액이 pH 변화를 억제하는 원리를 설명해줘.",
    "용해도가 온도에 따라 달라지는 이유를 설명해줘.",
    "산화수가 전자 이동을 추적하는 데 유용한 이유를 설명해줘.",
    "갈바니 전지에서 화학 에너지가 전기 에너지로 변환되는 이유를 설명해줘.",
    "고분자 물질이 다양한 물성을 갖는 이유를 설명해줘.",
    "촉매가 반응 전후에 소모되지 않는 이유를 설명해줘.",
    "세포 분열이 정확하게 조절되지 않으면 문제가 되는 이유를 설명해줘.",
    "효소 반응 속도가 기질 농도에 따라 포화되는 이유를 설명해줘.",
    "ATP가 즉각적인 에너지원으로 적합한 이유를 설명해줘.",
    "광합성에서 산소가 부산물로 생성되는 이유를 설명해줘.",
    "유전 암호가 중복성을 가지는 이유를 설명해줘.",
    "단백질 구조가 기능을 결정하는 이유를 설명해줘.",
    "신경 신호가 전기적·화학적 특성을 동시에 갖는 이유를 설명해줘.",
    "면역 반응이 과도하면 문제가 되는 이유를 설명해줘.",
    "항생제가 바이러스에 효과가 없는 이유를 설명해줘.",
    "생태계에서 먹이 그물이 먹이 사슬보다 적절한 이유를 설명해줘.",
    "피드백 제어에서 음의 되먹임이 안정성을 높이는 이유를 설명해줘.",
    "공학 시스템에서 과잉 설계가 항상 바람직하지 않은 이유를 설명해줘.",
    "모델 단순화가 예측 정확도를 오히려 높일 수 있는 이유를 설명해줘.",
    "신호 증폭 과정에서 잡음도 함께 증폭되는 이유를 설명해줘.",
    "구조물 설계에서 하중 분산이 중요한 이유를 설명해줘.",
    "열 손실을 완전히 제거할 수 없는 이유를 설명해줘.",
    "에너지 저장 장치에 한계가 존재하는 이유를 설명해줘.",
    "자동화 시스템에서 인간 개입이 필요한 이유를 설명해줘.",
    "공학 최적화 문제에 단일 해답이 없는 이유를 설명해줘.",
    "기술 발전이 새로운 공학 문제를 만드는 이유를 설명해줘.",
    "함수가 증가함수인지 감소함수인지 판단하는 기준을 설명해줘.",
    "미분이 순간 변화율을 나타내는 이유를 설명해줘.",
    "적분이 누적량 계산에 사용되는 이유를 설명해줘.",
    "연속 함수와 미분 가능 함수가 구분되는 이유를 설명해줘.",
    "극한 개념이 함수 값을 직접 대입하지 않고 정의되는 이유를 설명해줘.",
    "확률이 0과 1 사이 값으로 제한되는 이유를 설명해줘.",
    "확률 분포가 평균과 분산으로 요약될 수 있는 이유를 설명해줘.",
    "독립 사건 개념이 곱셈 법칙으로 표현되는 이유를 설명해줘.",
    "벡터가 크기와 방향을 함께 가지는 이유를 설명해줘.",
    "수학적 모델이 현실을 완벽히 재현할 수 없는 이유를 설명해줘.",
#100
    "운동량 보존 법칙이 외력이 없는 계에서만 성립하는 이유를 설명해줘.",
    "충돌 과정에서 에너지가 항상 보존되지 않는 이유를 설명해줘.",
    "원운동에서 구심력이 필요한 이유를 설명해줘.",
    "중력 퍼텐셜 에너지가 기준점에 따라 달라지는 이유를 설명해줘.",
    "열용량이 물질마다 다른 이유를 설명해줘.",
    "상변화 과정에서 온도가 일정하게 유지되는 이유를 설명해줘.",
    "도플러 효과가 파원과 관측자의 상대 운동과 연결되는 이유를 설명해줘.",
    "빛의 회절이 파동성의 증거가 되는 이유를 설명해줘.",
    "전기 저항이 도선의 길이와 단면적에 의존하는 이유를 설명해줘.",
    "유도 전류의 방향이 렌츠의 법칙으로 결정되는 이유를 설명해줘.",

    "원자 반지름이 주기율표에서 일정한 경향을 보이는 이유를 설명해줘.",
    "이온화 에너지가 원자 구조 정보로 활용되는 이유를 설명해줘.",
    "분자 간 힘이 화학 결합보다 약한 이유를 설명해줘.",
    "반응 속도식이 실험적으로 결정되는 이유를 설명해줘.",
    "르샤틀리에 원리가 평형 이동을 예측하는 데 유용한 이유를 설명해줘.",
    "산화제와 환원제가 항상 쌍으로 등장하는 이유를 설명해줘.",
    "전기 분해에서 외부 전원이 필요한 이유를 설명해줘.",
    "용액의 총괄성이 입자 수에 의존하는 이유를 설명해줘.",
    "결정 구조가 물질의 물성을 좌우하는 이유를 설명해줘.",
    "화학 반응식 계수가 질량 보존과 연결되는 이유를 설명해줘.",

    "원핵세포와 진핵세포가 구분되는 핵심 기준을 설명해줘.",
    "세포 소기관의 분업화가 효율성을 높이는 이유를 설명해줘.",
    "막 단백질이 세포 기능에서 중요한 이유를 설명해줘.",
    "DNA 복제가 반보존적으로 일어나는 이유를 설명해줘.",
    "유전자 발현이 세포 종류에 따라 달라지는 이유를 설명해줘.",
    "호르몬이 소량으로도 큰 효과를 내는 이유를 설명해줘.",
    "신경 전달 물질이 시냅스에서만 작용하는 이유를 설명해줘.",
    "면역 기억이 재감염 시 빠른 반응을 가능하게 하는 이유를 설명해줘.",
    "개체군 크기가 무한히 증가할 수 없는 이유를 설명해줘.",
    "생물 다양성이 생태계 안정성에 기여하는 이유를 설명해줘.",

    "제어 시스템에서 개루프와 폐루프의 차이를 설명해줘.",
    "공학 설계에서 트레이드오프가 발생하는 이유를 설명해줘.",
    "센서 오차가 시스템 성능에 영향을 미치는 이유를 설명해줘.",
    "신호 지연이 제어 불안정을 유발하는 이유를 설명해줘.",
    "재료 피로가 반복 하중에서 발생하는 이유를 설명해줘.",
    "열 응력이 구조물에 문제를 일으키는 이유를 설명해줘.",
    "에너지 변환 과정에서 손실이 발생하는 이유를 설명해줘.",
    "시스템 신뢰성이 단일 부품보다 중요한 이유를 설명해줘.",
    "공학 설계에서 표준이 필요한 이유를 설명해줘.",
    "복잡한 시스템이 예측하기 어려운 이유를 설명해줘.",

    "함수의 그래프가 정보를 시각적으로 제공하는 이유를 설명해줘.",
    "도함수의 부호가 함수의 증가·감소와 연결되는 이유를 설명해줘.",
    "적분 상수가 존재하는 이유를 설명해줘.",
    "미분 가능하면 연속이어야 하는 이유를 설명해줘.",
    "확률 변수 개념이 필요한 이유를 설명해줘.",
    "기댓값이 장기 평균으로 해석되는 이유를 설명해줘.",
    "분산이 데이터 흩어짐을 나타내는 이유를 설명해줘.",
    "조건부 확률이 정보 갱신으로 해석되는 이유를 설명해줘.",
    "행렬이 연립방정식을 효율적으로 표현하는 이유를 설명해줘.",
    "수학적 추상이 다양한 분야에 적용되는 이유를 설명해줘.",
#150
    "상대성 이론에서 동시에 일어나는 사건의 개념이 관측자에 따라 달라지는 이유를 설명해줘.",
    "관성 질량과 중력 질량이 동일하게 취급되는 이유를 설명해줘.",
    "진동계에서 공진 현상이 발생하는 이유를 설명해줘.",
    "감쇠가 없는 진동이 현실에서 성립하기 어려운 이유를 설명해줘.",
    "이상 기체 법칙이 특정 조건에서만 성립하는 이유를 설명해줘.",
    "열전달에서 복사가 진공에서도 가능한 이유를 설명해줘.",
    "파동의 에너지가 진폭에 의존하는 이유를 설명해줘.",
    "전자기 유도가 발전기의 기본 원리가 되는 이유를 설명해줘.",
    "저항의 온도 의존성이 물질 특성과 연결되는 이유를 설명해줘.",
    "양자화된 에너지 준위가 연속적이지 않은 이유를 설명해줘.",

    "전자 친화도가 원소의 반응성을 설명하는 데 유용한 이유를 설명해줘.",
    "분자의 극성이 용해도에 영향을 미치는 이유를 설명해줘.",
    "혼합 엔트로피가 자발적 혼합을 설명하는 이유를 설명해줘.",
    "반응 메커니즘에서 속도 결정 단계가 중요한 이유를 설명해줘.",
    "완충 작용이 약산과 짝염기로 구성되는 이유를 설명해줘.",
    "전극 전위가 반응 자발성 판단에 사용되는 이유를 설명해줘.",
    "용매가 반응 속도에 영향을 미치는 이유를 설명해줘.",
    "콜로이드가 침전되지 않고 안정한 이유를 설명해줘.",
    "결합 차수가 분자 구조 정보를 제공하는 이유를 설명해줘.",
    "화학 반응에서 에너지 프로파일이 중요한 이유를 설명해줘.",

    "원핵생물에서도 대사가 정교하게 조절되는 이유를 설명해줘.",
    "세포 주기가 여러 단계로 나뉘는 이유를 설명해줘.",
    "전사 조절이 번역 이후 조절보다 효율적인 이유를 설명해줘.",
    "단백질 접힘이 자발적으로 일어날 수 있는 이유를 설명해줘.",
    "효소 저해제가 대사 조절에 활용되는 이유를 설명해줘.",
    "신경계에서 활동 전위가 일정한 크기를 갖는 이유를 설명해줘.",
    "항체 다양성이 제한된 유전자 수로 가능한 이유를 설명해줘.",
    "개체 발생이 진화적 흔적을 부분적으로 반영하는 이유를 설명해줘.",
    "종 분화가 지리적 격리와 자주 연관되는 이유를 설명해줘.",
    "생태계에서 분해자가 필수적인 이유를 설명해줘.",

    "제어 시스템에서 안정성과 응답 속도가 트레이드오프 관계인 이유를 설명해줘.",
    "센서 해상도가 높을수록 잡음 영향이 커질 수 있는 이유를 설명해줘.",
    "시스템 모델 불확실성이 제어 성능을 제한하는 이유를 설명해줘.",
    "모듈화 설계가 유지보수를 용이하게 하는 이유를 설명해줘.",
    "재료의 미세 구조가 거시적 물성에 영향을 미치는 이유를 설명해줘.",
    "열팽창 계수 차이가 구조 결함을 유발하는 이유를 설명해줘.",
    "에너지 회수가 완전하지 않은 이유를 설명해줘.",
    "신뢰성 공학에서 중복 설계가 사용되는 이유를 설명해줘.",
    "공학 시스템에서 경계 조건 설정이 중요한 이유를 설명해줘.",
    "복잡계에서 비선형성이 예측을 어렵게 만드는 이유를 설명해줘.",

    "함수 합성이 새로운 함수 성질을 만드는 이유를 설명해줘.",
    "미분 연산이 선형성을 가지는 이유를 설명해줘.",
    "적분 구간 분할이 계산 결과를 바꾸지 않는 이유를 설명해줘.",
    "테일러 전개가 함수 근사에 사용되는 이유를 설명해줘.",
    "확률 밀도 함수의 적분값이 1이 되는 이유를 설명해줘.",
    "대수적 평균과 기하적 평균이 다른 의미를 갖는 이유를 설명해줘.",
    "상관관계가 인과관계를 의미하지 않는 이유를 설명해줘.",
    "벡터 내적이 각도 정보를 포함하는 이유를 설명해줘.",
    "행렬식이 기하학적 의미를 가지는 이유를 설명해줘.",
    "수학적 일반화가 개별 문제 해결력을 높이는 이유를 설명해줘.",
#200

]

output_file = "exaone_sciencemath_dataset.jsonl"
print(f"🚀 데이터 생성을 시작합니다... (모델: {TEACHER_MODEL_ID})")

successful_count = 0
with open(output_file, "a", encoding="utf-8") as f:
    for prompt in tqdm(seed_prompts):
        
        for attempt in range(5): 
            try:
                response = client.chat.completions.create(
                    model=TEACHER_MODEL_ID,
                    messages=[
                        {"role": "system", "content": "You are EXAONE, a helpful AI assistant."},
                        {"role": "user", "content": prompt}
                    ],
                    max_tokens=1024,
                    # temperature=0.7 (삭제됨)
                )
                
                answer = response.choices[0].message.content
                
                data_point = {
                    "instruction": prompt,
                    "output": answer
                }
                f.write(json.dumps(data_point, ensure_ascii=False) + "\n")
                f.flush()
                successful_count += 1
                
                time.sleep(2) 
                break 
                
            except Exception as e:
                error_msg = str(e)
                if "429" in error_msg or "Rate limit" in error_msg:
                    print(f"\n⏳ 너무 빨라요! 10초 대기 중... (시도 {attempt+1}/5)")
                    time.sleep(10)
                elif "422" in error_msg:
                    print(f"\n❌ 설정 오류: {e}")
                    break
                else:
                    print(f"\n❌ 알 수 없는 오류: {e}")
                    time.sleep(5)

print(f"\n✅ 완료! 총 {successful_count}개의 데이터가 '{output_file}'에 저장되었습니다.")